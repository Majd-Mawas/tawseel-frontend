<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="css/signin.css"
    />
    <style>
      .error-message {
        color: #ff3333;
        font-size: 14px;
        margin-top: 5px;
        text-align: left;
        display: none;
        animation: fadeIn 0.3s ease-out;
      }

      .input-group.error input {
        border-color: #ff3333;
        box-shadow: 0 0 5px rgba(255, 51, 51, 0.3);
      }
    </style>
  </head>

  <body>
    <div class="container">
      <form class="signin-form" onsubmit="handleSubmit(event)">
        <div class="form-heading">SIGN IN</div>
        <div class="input-group" id="email-group">
          <label class="label" for="email">Email</label>
          <input
            required
            placeholder="Enter your email"
            name="email"
            id="email"
            type="email"
          />
          <div class="error-message" id="email-error"></div>
        </div>
        <div class="input-group" id="password-group">
          <label class="label" for="password">Password</label>
          <input
            required
            placeholder="Enter your password"
            name="password"
            id="password"
            type="password"
          />
          <div class="error-message" id="password-error"></div>
        </div>
        <div class="forgot-password">
          <a href="forgot-password.html">Forgot password?</a>
        </div>
        <button class="submit" type="submit">sign in</button>
        <div class="signup-link">
          Don't have an account? <a href="signup.html">Sign up</a>
        </div>
      </form>
    </div>
    <script>
      const url = "https://tawseel.circleteams.com";
      // const url = "http://tawseel.test";

      // Function to clear error messages
      function clearErrors() {
        const errorElements = document.querySelectorAll(".error-message");
        errorElements.forEach((element) => {
          element.style.display = "none";
          element.textContent = "";
        });

        document.getElementById("email-group").classList.remove("error");
        document.getElementById("password-group").classList.remove("error");
      }

      // Function to show error message
      function showError(fieldId, message) {
        const errorElement = document.getElementById(fieldId + "-error");
        const inputGroup = document.getElementById(fieldId + "-group");

        if (errorElement && inputGroup) {
          errorElement.textContent = message;
          errorElement.style.display = "block";
          inputGroup.classList.add("error");
        }
      }

      async function handleSubmit(event) {
        event.preventDefault();
        clearErrors(); // Clear any previous errors

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        try {
          const response = await fetch(url + "/api/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, password }),
          });

          if (response.ok) {
            const DataResponse = await response.json();

            if (DataResponse.data.token) {
              console.log("Response data:", DataResponse.data);
              localStorage.setItem("token", DataResponse.data.token);
            }
            window.location.href = "home.html";
          } else {
            // Handle different error status codes
            if (response.status === 401) {
              showError("password", "Incorrect password. Please try again.");
            } else if (response.status === 404) {
              showError(
                "email",
                "Email not found. Please check your email address."
              );
            } else {
              // Try to get more specific error message from response
              try {
                const errorData = await response.json();
                if (errorData.message) {
                  showError("password", errorData.message);
                } else {
                  showError(
                    "password",
                    "Login failed. Please check your credentials."
                  );
                }
              } catch (e) {
                showError(
                  "password",
                  "Login failed. Please check your credentials."
                );
              }
            }
          }
        } catch (error) {
          console.error("Error:", error);
          showError(
            "password",
            "An error occurred during login. Please try again later."
          );
        }
      }
    </script>
  </body>
</html>
